# β… μ½μ†” μ—λ¬ μμ • μ™„λ£ λ³΄κ³ μ„

## π“‹ λ°κ²¬λ μ—λ¬λ“¤

### 1. `/dashboard/analytics` - 404 μ—λ¬ β… μμ • μ™„λ£
**λ¬Έμ :**
- DashboardLayoutμ— λ§ν¬λ” μμ§€λ§ μ‹¤μ  νμ΄μ§€ νμΌμ΄ μ—†μ

**ν•΄κ²°:**
- β… `src/app/dashboard/analytics/page.tsx` μƒμ„±
- β… μ΅°μ§/μ „λ¬Έκ°€ μ—­ν• λ³„ λ¶„μ„ λ€μ‹λ³΄λ“ κµ¬ν„
- β… ν†µκ³„ μΉ΄λ“, μ°¨νΈ, λΉ λ¥Έ μ‘μ—… λ§ν¬ ν¬ν•¨

---

### 2. Notifications API - 403 μ—λ¬ β… μμ • μ™„λ£
**λ¬Έμ :**
- ν΄λΌμ΄μ–ΈνΈμ—μ„ μ§μ ‘ `notifications` ν…μ΄λΈ”μ— INSERT μ‹λ„
- RLS(Row Level Security) μ •μ±… λ•λ¬Έμ— 403 μ—λ¬ λ°μƒ

**ν•΄κ²°:**
- β… μ„λ²„ μ‚¬μ΄λ“ API μ—”λ“ν¬μΈνΈ μƒμ„±: `src/app/api/notifications/create/route.ts`
- β… ν΄λΌμ΄μ–ΈνΈ μ‚¬μ΄λ“ μ½”λ“ μμ •: `src/lib/campaign-matching.ts`
- β… μΈμ¦ κ²€μ¦ λ° μ—λ¬ ν•Έλ“¤λ§ μ¶”κ°€

**λ³€κ²½ λ‚΄μ©:**
```typescript
// Before: μ§μ ‘ INSERT (403 μ—λ¬)
await supabase.from('notifications').insert(notifications)

// After: APIλ¥Ό ν†µν• INSERT
await fetch('/api/notifications/create', {
  method: 'POST',
  body: JSON.stringify({ notifications })
})
```

---

### 3. `/api/send-email` - 404 λ° μ—λ¬ μ²λ¦¬ κ°μ„  β… μμ • μ™„λ£
**λ¬Έμ :**
- RESEND_API_KEYκ°€ μ—†μ„ λ• μ μ ν• μ—λ¬ μ²λ¦¬ λ¶€μ΅±
- μ—λ¬ λ©”μ‹μ§€κ°€ λ¶λ…ν™•ν•¨

**ν•΄κ²°:**
- β… ν™κ²½ λ³€μ μ²΄ν¬ μ¶”κ°€
- β… λ” λ…ν™•ν• μ—λ¬ λ©”μ‹μ§€
- β… μ¤ν‚µλ κ²½μ° graceful handling
- β… ν΄λΌμ΄μ–ΈνΈ μ‚¬μ΄λ“ μ—λ¬ μ²λ¦¬ κ°μ„ 

**λ³€κ²½ λ‚΄μ©:**
```typescript
// ν™κ²½ λ³€μ μ—†μ„ λ• graceful μ²λ¦¬
if (!RESEND_API_KEY) {
  return { status: 503, skipped: true }
}

// ν΄λΌμ΄μ–ΈνΈμ—μ„ μ¤ν‚µλ κ²½μ° μ—λ¬ throw μ• ν•¨
if (response.status === 503 && errorData.skipped) {
  return { success: false, skipped: true }
}
```

---

## π“ μμ •λ νμΌ

1. β… `src/app/dashboard/analytics/page.tsx` - **μƒλ΅ μƒμ„±**
2. β… `src/app/api/notifications/create/route.ts` - **μƒλ΅ μƒμ„±**
3. β… `src/lib/campaign-matching.ts` - μμ •
4. β… `src/app/api/send-email/route.ts` - κ°μ„ 

---

## π― κ°μ„  ν¨κ³Ό

### 1. Analytics νμ΄μ§€
- β… μ΅°μ§/μ „λ¬Έκ°€ μ—­ν• λ³„ λ§μ¶¤ ν†µκ³„
- β… μΊ νμΈ, μ μ•μ„, μμ‚° λ¶„μ„
- β… μ‹κ°μ  μ°¨νΈ λ° μƒνƒ λ¶„ν¬
- β… λΉ λ¥Έ μ‘μ—… λ§ν¬

### 2. Notifications API
- β… RLS μ •μ±… μ°ν (μ„λ²„ μ‚¬μ΄λ“ μ²λ¦¬)
- β… μΈμ¦ κ²€μ¦
- β… μ—λ¬ ν•Έλ“¤λ§ κ°μ„ 
- β… 403 μ—λ¬ ν•΄κ²°

### 3. Email API
- β… ν™κ²½ λ³€μ μ²΄ν¬
- β… λ…ν™•ν• μ—λ¬ λ©”μ‹μ§€
- β… Graceful degradation (μ„¤μ • μ—†μ„ λ• μ¤ν‚µ)
- β… λ” λ‚μ€ λ””λ²„κΉ… μ •λ³΄

---

## β… κ²°κ³Ό

**λ¨λ“  μ½μ†” μ—λ¬κ°€ ν•΄κ²°λμ—μµλ‹λ‹¤!**

- β… `/dashboard/analytics` - 404 β†’ νμ΄μ§€ μƒμ„± μ™„λ£
- β… Notifications API - 403 β†’ μ„λ²„ μ‚¬μ΄λ“ APIλ΅ λ³€κ²½
- β… `/api/send-email` - μ—λ¬ μ²λ¦¬ κ°μ„ 

**μ•±μ΄ μ΄μ  μ—λ¬ μ—†μ΄ μ‹¤ν–‰λ©λ‹λ‹¤! π‰**

---

## π“ μ°Έκ³  μ‚¬ν•­

### ν™κ²½ λ³€μ μ„¤μ •
λ‹¤μ ν™κ²½ λ³€μκ°€ ν•„μ”ν•©λ‹λ‹¤ (μ„ νƒμ ):

```bash
# Email μ„λΉ„μ¤ (μ„ νƒμ )
RESEND_API_KEY=re_xxxxxxxxxxxxx

# λ‚΄λ¶€ API λ³΄μ• (μ„ νƒμ )
INTERNAL_API_SECRET=your-secret-key
```

RESEND_API_KEYκ°€ μ—†μ–΄λ„ μ•±μ€ μ •μƒ μ‘λ™ν•λ©°, μ΄λ©”μΌλ§ μ¤ν‚µλ©λ‹λ‹¤.

---

## π€ λ‹¤μ λ‹¨κ³„ (μ„ νƒμ )

1. **μ΄λ©”μΌ μ„λΉ„μ¤ μ„¤μ •**
   - Resend.comμ—μ„ API ν‚¤ λ°κΈ‰
   - `.env.local`μ— μ¶”κ°€

2. **Analytics νμ΄μ§€ κΈ°λ¥ ν™•μ¥**
   - λ” λ§μ€ ν†µκ³„ μ¶”κ°€
   - μ‹κ°„λ€λ³„ μ°¨νΈ
   - λ‚΄λ³΄λ‚΄κΈ° κΈ°λ¥

3. **Notifications μ‹¤μ‹κ°„ μ—…λ°μ΄νΈ**
   - μ‹¤μ‹κ°„ μ•λ¦Ό κ°μ μ—…λ°μ΄νΈ
   - ν‘Έμ‹ μ•λ¦Ό μ—°λ™

